Securly IWF List Decoding
-------------------------

Securly routes this list through their official CDN, it is handpicked by the IWF to help web-filter child pornography. The list is known to update 1-2 times daily. Securly attempts to encode this list by running each line through a Base64 encoding scheme, transposing each character three ascii values backwards, and joining the characters again. Their script includes a step variable, yet this variable is not only accessible directly through the console, but by it is also a static number (3). I believe that many of Securly's issues with this exploit could be solved by updating this step variable with each list update. Also, they would need to find a way to make sure that this step variable cannot be interpreted by the user in any way.

**The original encoding functions**

    //Step number found by running IWFEncodeStep(); in console of extension background page
    
    //Raw function taken from Securly extension
    function myB64Encode(str, step) {
    	var res = window.btoa(str).split('');
    	for (var i = 0; i < res.length; i++) {
    		res[i] = myB64EncodeHelper(res[i], step);
    	}
    	return res.join('');
    }
    
    
    
    //Raw function taken from Securly extension
    function myB64EncodeHelper(c, step) {
    	var asciiPos = c.charCodeAt(0);
    	if ('0' <= c && c <= '9') {
    		step %= 10;
    		asciiPos += step;
    		if (asciiPos > '9'.charCodeAt(0)) {
    			asciiPos -= 10;
    		}
    	} else if ('A' <= c && c <= 'Z') {
    		step %= 26;
    		asciiPos += step;
    		if (asciiPos > 'Z'.charCodeAt(0)) {
    			asciiPos -= 26;
    		}
    	} else if ('a' <= c && c <= 'z') {
    		step %= 26;
    		asciiPos += step;
    		if (asciiPos > 'z'.charCodeAt(0)) {
    			asciiPos -= 26;
    		}
    	}
    	return String.fromCharCode(asciiPos);
    }



To decode this is simple, I created two new functions that are pretty much reverses of the originals. It splits each encoded string into an array of characters, then transposes the ascii position of each letter down three. When the transposing is done, the script joins the letters and decodes from base64. In these functions I ignored the original step variable because it was statically set to three.

**Decoding functions**

    //Reverse function of myB64Encode
    function Decode(str) {
    	//split string into parts
    	var res = str.split('');
    	//for each character of string, run through DecodeHelper
    	for (var i = 0; i < res.length; i++) {
    		res[i] = DecodeHelper(res[i]);
    	}
    	//rejoin output characters as string
    	res = res.join('');
    	//return base64 decoded string
    	return window.atob(res);
    }
    
    //Reverse function of myB64EncodeHelper, step number always 3
    function DecodeHelper(c) {
    	//set variable to ascii code of inputed character
    	var asciiPos = c.charCodeAt(0);
    	//if character is number, subtract 3 ascii positions
    	//if that makes it less than 0, add ten to balance it
    	if ('0' <= c && c <= '9') {
    		asciiPos -= 3;
    		if (asciiPos < '0'.charCodeAt(0)) {
    			asciiPos += 10;
    		}
    		//if character is uppercase letter, subtract 3 ascii positions
    		//if that makes it less than 'A', add twenty-six to balance it
    	} else if ('A' <= c && c <= 'Z') {
    		asciiPos -= 3;
    		if (asciiPos < 'A'.charCodeAt(0)) {
    			asciiPos += 26;
    		}
    		//if character is lowercase letter, subtract 3 ascii positions
    		//if that makes it less than 'a', add twenty-six to balance it
    	} else if ('a' <= c && c <= 'z') {
    		asciiPos -= 3;
    		if (asciiPos < 'a'.charCodeAt(0)) {
    			asciiPos += 26;
    		}
    	}
    	//return character from outputed ascii code
    	return String.fromCharCode(asciiPos);
    }

The main page that I have created organizes the live encoded results from Securly's IWF list, along with the decoded results, into an organized table. You can view this table by uploading the files to a server or by downloading the iwf-encode.txt and changing the decodePage function in main.js.

![table image](http://i.imgur.com/cbyaZKw.png)
 
